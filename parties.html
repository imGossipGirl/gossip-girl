<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gossip Girl — Parties</title>

<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Gossip_girl_titlecard.svg/1200px-Gossip_girl_titlecard.svg.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Roboto', sans-serif;
  background: url('https://primary.jwwb.nl/public/v/f/z/temp-drvbpvglefwdvbrbqnho/ur18xk/IMG_1169.jpg')
    no-repeat center center fixed;
  background-size: cover;
}

.container {
  max-width: 650px;
  margin: 40px auto;
  padding: 20px;
}

.card {
  background: rgba(255,255,255,0.96);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  margin-bottom: 30px;
}

h3 {
  font-family: 'Playfair Display', serif;
  margin-bottom: 10px;
}

.party {
  border-top: 1px solid #ddd;
  padding-top: 15px;
  margin-top: 15px;
}

.party img {
  width: 100%;
  border-radius: 10px;
  margin: 10px 0;
}

.meta {
  font-size: 0.75rem;
  color: #777;
}

input, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

textarea { min-height: 80px; }

button {
  width: 100%;
  padding: 10px;
  background: black;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button.secondary {
  background: #ccc;
  color: #333;
  margin-top: 8px;
}

.delete-btn {
  background: #7a2c2c;
  font-size: 0.75rem;
}
</style>
</head>

<body>

<div class="container">

  <div class="card" style="text-align:center;">
    <button class="secondary" onclick="location.href='index.html'">← Back to Home</button>
  </div>

  <!-- ADMIN LOGIN -->
  <div id="loginBox" class="card">
    <h3>Gossip Girl Login</h3>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <!-- ADMIN FORM -->
  <div id="adminForm" class="card" style="display:none;">
    <h3>Add New Party</h3>

    <input id="partyTitle" placeholder="Party name">
    <input id="partyLocation" placeholder="Location">
    <input id="partyTime" placeholder="Date / Time">
    <textarea id="partyDesc" placeholder="What happened?"></textarea>
    <input id="partyImage" placeholder="Image URL (optional)">

    <button onclick="addParty()">Post Party</button>
    <button class="secondary" onclick="logout()">Logout</button>
  </div>

  <!-- PARTY LIST -->
  <div class="card">
    <h3>Spotted: Upper East Side Parties</h3>
    <div id="partyList"></div>
  </div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAG70-TmzFjnvgZhRkPR1DuDOrTComfwsc",
  authDomain: "gossip-girl-4e394.firebaseapp.com",
  projectId: "gossip-girl-4e394"
});

const auth = firebase.auth();
const db = firebase.firestore();

const loginBox = document.getElementById("loginBox");
const adminForm = document.getElementById("adminForm");
const partyList = document.getElementById("partyList");

/* AUTH */
function login() {
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(err => alert(err.message));
}

function logout() {
  auth.signOut();
}

auth.onAuthStateChanged(user => {
  loginBox.style.display = user ? "none" : "block";
  adminForm.style.display = user ? "block" : "none";
});

/* ADD PARTY */
function addParty() {
  if (!partyTitle.value || !partyDesc.value) {
    alert("Missing details");
    return;
  }

  db.collection("parties").add({
    title: partyTitle.value,
    location: partyLocation.value,
    time: partyTime.value,
    desc: partyDesc.value,
    image: partyImage.value || "",
    created: Date.now()
  });

  partyTitle.value = "";
  partyLocation.value = "";
  partyTime.value = "";
  partyDesc.value = "";
  partyImage.value = "";
}

/* LOAD PARTIES (PUBLIC) */
db.collection("parties").orderBy("created", "desc")
.onSnapshot(snapshot => {
  partyList.innerHTML = "";
  snapshot.forEach(doc => {
    const p = doc.data();
    partyList.innerHTML += `
      <div class="party">
        <strong>${p.title}</strong>
        <p>${p.desc}</p>
        ${p.image ? `<img src="${p.image}">` : ""}
        <p class="meta">${p.location || ""} ${p.time || ""}</p>
        ${auth.currentUser ? `<button class="delete-btn" onclick="deleteParty('${doc.id}')">Delete</button>` : ""}
      </div>
    `;
  });
});

/* DELETE */
function deleteParty(id) {
  if (confirm("Delete this party?")) {
    db.collection("parties").doc(id).delete();
  }
}
</script>

</body>
</html>

